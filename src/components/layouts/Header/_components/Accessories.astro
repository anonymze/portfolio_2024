---
import FlagFrSVG from "@assets/icons/flag-fr.svg?raw";
import FlagEnSVG from "@assets/icons/flag-en.svg?raw";
import DarkIcon from "@assets/icons/dark.svg?raw";
import MailSVG from "@assets/icons/mail.svg?raw";
import PopoverCard from "@/components/PopoverCard.astro";
import { i18n } from "@/i18n/translations";
import { I18n } from "@/types/i18n";
import { switchRouteLocale } from "@/utils/server/locale";

const locale = Astro.currentLocale as I18n;
const route_switch_locale = switchRouteLocale(Astro.url.pathname, Astro.currentLocale!);
---

<!-- z-index because svgs can be hover the li on certain timing -->
<li class="fading-in z-1" style="--transition-delay-count: 0;">
	<PopoverCard toBottom message={i18n[locale]("EMAIL_COPIED")} set:html={MailSVG} />
</li>

<li class="fading-in" style="--transition-delay-count: 1;">
	<button aria-label="Switch theme" id="theme-toggle" set:html={DarkIcon} />
</li>

<li class="fading-in" style="--transition-delay-count: 2;">
	<a
		aria-label="Switch language"
		href={route_switch_locale}
		href-lang={locale}
		set:html={locale === I18n["FR"] ? FlagEnSVG : FlagFrSVG}
	/>
</li>

<script>
	import { getPreferredTheme, setPreferredTheme } from "@/utils/client/theme";
	import DarkIcon from "@assets/icons/dark.svg?raw";
	import LightIcon from "@assets/icons/light.svg?raw";

	const button_theme_toggle = document.getElementById("theme-toggle")!;

	button_theme_toggle.innerHTML = getPreferredTheme("data-theme") === "dark" ? DarkIcon : LightIcon;

	const toggleTheme = () => {
		const theme = setPreferredTheme("data-theme");
		button_theme_toggle.innerHTML = theme === "dark" ? DarkIcon : LightIcon;
	};

	button_theme_toggle.addEventListener("click", toggleTheme);
</script>
